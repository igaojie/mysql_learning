# ç›‘æŽ§
PMM = Percona Monitoring and Managementã€‚
PMMæä¾›äº†å¯¹MyISAMã€InnoDBã€TokuDBã€PXC/Glareraçš„ç›‘æŽ§ã€‚
å¹¶ä¸”æä¾›ç¡¬ç›˜ã€ç½‘ç»œã€CPUã€RAMä»¥åŠContext switcheså’ŒProcessesçš„ç›‘æŽ§ã€‚
Context switcheså¯ä»¥çœ‹åˆ°CPUä¸Šä¸‹æ–‡åˆ‡æ¢çš„çŠ¶å†µã€‚
Processeså¯ä»¥æ–¹ä¾¿äº†è§£ç³»ç»Ÿæœ‰å¤šå°‘ç¨‹åºåœ¨ç­‰å¾…IO

1. ç›‘æŽ§æ ¸å¿ƒSQL
2. ç›‘æŽ§æ ¸å¿ƒæŒ‡æ ‡
3. æŠ¥è­¦

PMM æœ‰ PMM Client å’Œ PMM Serverç»„æˆã€‚PMM Clientè´Ÿè´£æ”¶é›†MySQLæˆ–è€…MongoDBå®žä¾‹çš„çŠ¶æ€æ•°æ®å¹¶å‘é€ç»™PMM Serverã€‚è€ŒServerè´Ÿè´£å°†æ”¶é›†åˆ°çš„æ•°æ®å­˜å‚¨ã€èšåˆå’Œå±•çŽ°ã€‚

## å®‰è£…
### 1. å®‰è£…docker for Mac
å‚è€ƒï¼šhttps://www.percona.com/doc/percona-monitoring-and-management/deploy/server/docker.setting-up.html


```
âžœ  ~ git:(master) âœ— brew install docker
Updating Homebrew...
==> Auto-updated Homebrew!
Updated 3 taps (homebrew/core, homebrew/php, caskroom/cask).
==> Updated Formulae
sysbench âœ”      ccm             elvish          ibex            kotlin          libre           postgis         tile38
azure-cli       certbot         geoip           idnits          libdvdread      libuv           rpm             todoman
binaryen        chakra          git             jenkins-lts     libmaxminddb    linkerd         serialosc       transmission
bzt             chuck           gjs             joplin          libmonome       modules         stress-ng       ttyd
cake            elixir          hugo            juju            libqalculate    paket           svgcleaner

==> Downloading https://homebrew.bintray.com/bottles/docker-18.01.0.high_sierra.bottle.tar.gz
######################################################################## 100.0%
==> Pouring docker-18.01.0.high_sierra.bottle.tar.gz
==> Caveats
Bash completion has been installed to:
  /usr/local/etc/bash_completion.d

zsh completions have been installed to:
  /usr/local/share/zsh/site-functions

fish completions have been installed to:
  /usr/local/share/fish/vendor_completions.d
==> Summary
ðŸº  /usr/local/Cellar/docker/18.01.0: 8 files, 49.6MB


âžœ  ~ git:(master) âœ— docker --version
Docker version 18.01.0-ce, build 03596f5



âžœ  ~ git:(master) âœ— brew install docker-machine
==> Downloading https://homebrew.bintray.com/bottles/docker-machine-0.13.0.high_sierra.bottle.tar.gz
######################################################################## 100.0%
==> Pouring docker-machine-0.13.0.high_sierra.bottle.tar.gz
==> Caveats
Bash completion has been installed to:
  /usr/local/etc/bash_completion.d

zsh completions have been installed to:
  /usr/local/share/zsh/site-functions

To have launchd start docker-machine now and restart at login:
  brew services start docker-machine
Or, if you don't want/need a background service you can just run:
  docker-machine start
==> Summary
ðŸº  /usr/local/Cellar/docker-machine/0.13.0: 11 files, 31.2MB
âžœ  ~ git:(master) âœ— docker-machine --version
docker-machine version 0.13.0, build 9ba6da9



âžœ  ~ git:(master) âœ— docker-compose --version
zsh: command not found: docker-compose
âžœ  ~ git:(master) âœ— brew install docker-compose
==> Installing dependencies for docker-compose: libyaml
==> Installing docker-compose dependency: libyaml
==> Downloading https://homebrew.bintray.com/bottles/libyaml-0.1.7.high_sierra.bottle.tar.gz
######################################################################## 100.0%
==> Pouring libyaml-0.1.7.high_sierra.bottle.tar.gz
ðŸº  /usr/local/Cellar/libyaml/0.1.7: 9 files, 299.8KB
==> Installing docker-compose
==> Downloading https://homebrew.bintray.com/bottles/docker-compose-1.18.0.high_sierra.bottle.tar.gz
######################################################################## 100.0%
==> Pouring docker-compose-1.18.0.high_sierra.bottle.tar.gz
==> Caveats
Bash completion has been installed to:
  /usr/local/etc/bash_completion.d

zsh completions have been installed to:
  /usr/local/share/zsh/site-functions
==> Summary
ðŸº  /usr/local/Cellar/docker-compose/1.18.0: 837 files, 9.2MB

âžœ  ~ git:(master) âœ— docker-compose --version
docker-compose version 1.18.0, build unknown
âžœ  ~ git:(master) âœ—



âžœ  ~ git:(master) âœ— brew install xhyve docker-machine-driver-xhyve
==> Downloading https://homebrew.bintray.com/bottles/xhyve-0.2.0.high_sierra.bottle.1.tar.gz
######################################################################## 100.0%
==> Pouring xhyve-0.2.0.high_sierra.bottle.1.tar.gz
ðŸº  /usr/local/Cellar/xhyve/0.2.0: 10 files, 11.2MB
==> Installing dependencies for docker-machine-driver-xhyve: libev
==> Installing docker-machine-driver-xhyve dependency: libev
==> Downloading https://homebrew.bintray.com/bottles/libev-4.24.high_sierra.bottle.tar.gz
######################################################################## 100.0%
==> Pouring libev-4.24.high_sierra.bottle.tar.gz
ðŸº  /usr/local/Cellar/libev/4.24: 12 files, 432.8KB
==> Installing docker-machine-driver-xhyve
==> Downloading https://homebrew.bintray.com/bottles/docker-machine-driver-xhyve-0.3.3.high_sierra.bottle.1.tar.gz
######################################################################## 100.0%
==> Pouring docker-machine-driver-xhyve-0.3.3.high_sierra.bottle.1.tar.gz
==> Caveats
This driver requires superuser privileges to access the hypervisor. To
enable, execute
    sudo chown root:wheel /usr/local/opt/docker-machine-driver-xhyve/bin/docker-machine-driver-xhyve
    sudo chmod u+s /usr/local/opt/docker-machine-driver-xhyve/bin/docker-machine-driver-xhyve
==> Summary
ðŸº  /usr/local/Cellar/docker-machine-driver-xhyve/0.3.3: 3 files, 10.5MB

```
### 1.1 æ¸…é™¤ä¹‹å‰Dockerå®‰è£…çš„ä¿¡æ¯
```
âžœ  ~ git:(master) âœ—
âžœ  ~ git:(master) âœ— sh -c "$(curl -fsSl https://raw.githubusercontent.com/docker/toolbox/master/osx/uninstall.sh)"
Remove all Docker Machine VMs? (Y/N): y
Usage: docker-machine rm [OPTIONS] [arg...]

Remove a machine

Description:
   Argument(s) are one or more machine names.

Options:

   --force, -f	Remove local configuration even if machine cannot be removed, also implies an automatic yes (`-y`)
   -y		Assumes automatic yes to proceed with remove, without prompting further user confirmation
Error: Expected to get one or more machine names as arguments
Removing Applications...
Removing docker binaries...
Removing boot2docker.iso
Forget packages
No receipt for 'io.docker.pkg.docker' found at '/'.
No receipt for 'io.docker.pkg.dockercompose' found at '/'.
No receipt for 'io.docker.pkg.dockermachine' found at '/'.
No receipt for 'io.boot2dockeriso.pkg.boot2dockeriso' found at '/'.
All Done!
âžœ  ~ git:(master) âœ— sudo rm -rf ~/.docker

```

### 2. åˆ›å»ºmachine
```
âžœ  ~ git:(master) âœ—
âžœ  ~ git:(master) âœ— docker-machine create default --driver xhyve --xhyve-experimental-nfs-share --engine-registry-mirror=https://xxx.mirror.aliyuncs.com
Creating CA: /Users/ShaoGaoJie/.docker/machine/certs/ca.pem
Creating client certificate: /Users/ShaoGaoJie/.docker/machine/certs/cert.pem
Running pre-create checks...
Error with pre-create check: "docker-machine-driver-xhyve binary needs root owner and uid. See https://github.com/zchee/docker-machine-driver-xhyve#install"
âžœ  ~ git:(master) âœ—

```

### 3. é•œåƒ

```
âžœ  ~ git:(master) âœ— cd Works/mysqldata
âžœ  mysqldata git:(master) âœ— docker pull percona/pmm-server:latest
latest: Pulling from percona/pmm-server
85432449fd0f: Pull complete
f366db7bb0d7: Pull complete
702ef97f7925: Pull complete
d9e6e0965c68: Pull complete
83d9c898803b: Pull complete
b86122913f1e: Pull complete
57117cab01ea: Pull complete
197f30644eb4: Pull complete
18fc6d6ea79c: Pull complete
Digest: sha256:3fc6934468e698b86ee799b9b753cd8b4411a169b12118dfb461e4faf9d6d7e3
Status: Downloaded newer image for percona/pmm-server:latest
âžœ  mysqldata git:(master) âœ—

```

### 4. åˆ›å»ºå®¹å™¨çš„æ•°æ®ç£ç›˜
```
 mysqldata git:(master) âœ— docker create \
   -v /opt/prometheus/data \
   -v /opt/consul-data \
   -v /var/lib/mysql \
   -v /var/lib/grafana \
   --name pmm-data \
   percona/pmm-server:latest /bin/true
a6af8f1df8135bff28117548d877000c71acce0cccc84ef3c19fead95574a2e4

```


### 5.å¯åŠ¨Server
```
âžœ  mysqldata git:(master) âœ—  docker run -d \
   -p 80:80 \
   --volumes-from pmm-data \
   --name pmm-server \
   --restart always \
   percona/pmm-server:latest
ae99d8acdc615a9aa89e16026afce7c04c1cecfab78faa2b7c832745ddcfe6b8


âžœ  mysql_learning git:(master) docker ps
CONTAINER ID        IMAGE                       COMMAND                CREATED             STATUS              PORTS                         NAMES
ae99d8acdc61        percona/pmm-server:latest   "/opt/entrypoint.sh"   4 minutes ago       Up 4 minutes        0.0.0.0:80->80/tcp, 443/tcp   pmm-server
âžœ  mysql_learning git:(master) âœ—


```

### 6.åœæ­¢å®¹å™¨
```
-> docker stop pmm-server
pmm-server

// åˆ æŽ‰å®¹å™¨
-> docker rm pmm-server
pmm-server


ShaoGaoJie@MacBook-Air-2 ~/W/git> docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
ShaoGaoJie@MacBook-Air-2 ~/W/git>
ShaoGaoJie@MacBook-Air-2 ~/W/git>
ShaoGaoJie@MacBook-Air-2 ~/W/git>

//ä¸ºè¯¥æœåŠ¡é‡æ–°å‘½åä¸€ä¸ªç«¯å£å· å…å¾—å½±å“å…¶ä»–çš„webæœåŠ¡
ShaoGaoJie@MacBook-Air-2 ~/W/git> docker run -d \
                                     -p 8080:80 \
                                     --volumes-from pmm-data \
                                     --name pmm-server \
                                     --restart always \
                                     percona/pmm-server:latest
bb7786cda5465edfc4667ea6b1d19722697d2504afabe6e3770491f6922bc8de

è¿™ä¸ªæ—¶å€™è®¿é—®ä¸€ä¸‹  127.0.0.1:8080 å°±èƒ½çœ‹åˆ°pmmçš„ç®¡ç†å¹³å°äº†ã€‚

ä¸‹é¢è¿›è¡Œä¸€ä¸‹ä»£ç†ã€‚æˆ‘ä½¿ç”¨nginxåšä»£ç†ã€‚é…ç½®æ–‡ä»¶å¦‚ä¸‹ :
é€šè¿‡è®¿é—®local.pmm.me æ¥è®¿é—®pmmå¹³å°

server {
        listen  80;
        server_name   local.pmm.me;


        location / {
                proxy_pass http://127.0.0.1:8080;
        }
}


```



### ç™»å½•docker
```
âžœ  Works git:(master) âœ— docker exec -it pmm-server /bin/bash

```

## å®‰è£…Agent
```
1. ä¸‹è½½ https://www.percona.com/downloads/pmm/1.6.0/source/tarball/pmm-client-1.6.0.tar.gz
2. /Users/ShaoGaoJie/Works/mysqldata/pmm-client-1.6.0
3. 

```



----------------------------------------------
----------------------------------------------


## Centoså®‰è£…docker
```
yum -y install docker

[root@10.70.1.232 ~]#yum -y install docker
Loaded plugins: fastestmirror, priorities
Setting up Install Process
Loading mirror speeds from cached hostfile
epel/metalink                                                                                                                                             | 7.0 kB     00:00
 * base: mirror.bit.edu.cn
 * epel: mirrors.ustc.edu.cn
 * extras: mirror.bit.edu.cn
 * updates: mirrors.tuna.tsinghua.edu.cn
base                                                                                                                                                      | 3.7 kB     00:00
epel                                                                                                                                                      | 4.7 kB     00:00
epel/primary_db                                                                                                                                           | 6.0 MB     00:06
extras                                                                                                                                                    | 3.4 kB     00:00
updates                                                                                                                                                   | 3.4 kB     00:00
updates/primary_db                                                                                                                                        | 5.8 MB     00:06
xin                                                                                                                                                       | 2.9 kB     00:00
168 packages excluded due to repository priority protections
Resolving Dependencies
--> Running transaction check
---> Package docker.x86_64 0:1.5-5.el6 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

=================================================================================================================================================================================
 Package                                   Arch                                      Version                                       Repository                               Size
=================================================================================================================================================================================
Installing:
 docker                                    x86_64                                    1.5-5.el6                                     epel                                     19 k

Transaction Summary
=================================================================================================================================================================================
Install       1 Package(s)

Total download size: 19 k
Installed size: 37 k
Downloading Packages:
docker-1.5-5.el6.x86_64.rpm                                                                                                                               |  19 kB     00:00
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : docker-1.5-5.el6.x86_64                                                                                                                                       1/1
  Verifying  : docker-1.5-5.el6.x86_64                                                                                                                                       1/1

Installed:
  docker.x86_64 0:1.5-5.el6

Complete!
[root@10.70.1.232 ~]#

```




## 2. Centos å®‰è£…PMM-SERVER
```


```


